<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캐릭터 상태창 (B커플)</title>
    <style>
        /* Google Fonts Import */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@900&display=swap');

        /* Base Styling */
        body {
            background-color: #333;
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            transition: background-image 1s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Main Column Layout */
        .two-dialog-col {
            --item-padding: 10px;
            --item-sprite-line: rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            gap: var(--item-padding);
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
        }

        .two-dialog-dialog {
            display: flex;
            flex-direction: column;
            gap: var(--item-padding);
            width: 100%;
        }

        .two-dialog-container {
            display: flex;
            gap: var(--item-padding);
            flex-wrap: nowrap;
            justify-content: center;
            width: 100%;
        }

        /* Character Card Styling */
        .two-dialog-card {
            width: calc(50% - (var(--item-padding) / 2));
            height: 480px;
            border-radius: 8px;
            background: repeating-linear-gradient(
                45deg,
                var(--item-sprite-line),
                var(--item-sprite-line) 2px,
                transparent 2px,
                transparent 6px
            );
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            overflow: hidden;
            transition: width 0.5s ease-in-out, transform 0.3s ease;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .two-dialog-char-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 20%;
            margin: 0;
            transition: filter 0.5s, transform 0.5s ease-in-out;
        }
        
        .two-dialog-card:hover {
            width: 60%;
            transform: scale(1.02);
            z-index: 10;
        }

        .two-dialog-card:hover > .two-dialog-char-img {
            filter: blur(5px) brightness(0.7);
            transform: scale(1.1);
        }

        .two-dialog-info {
            font-family: 'Gowun Batang', 'Roboto', sans-serif;
            position: absolute;
            z-index: 1;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 4px;
            padding: 15px;
            opacity: 0;
            transition: opacity 0.5s;
            max-height: 90%;
            overflow-y: auto;
            width: 90%;
            color: white;
            visibility: hidden;
        }

        .two-dialog-card:hover .two-dialog-info {
            opacity: 1;
            visibility: visible;
        }

        .two-dialog-info-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 0.9em;
            line-height: 1.5;
            display: flex;
            gap: 8px;
        }
        .two-dialog-info-box .label {
            font-weight: bold;
            color: #ddd;
            flex-shrink: 0;
        }
        .two-dialog-info-box .value {
            flex-grow: 1;
            color: #fff;
            outline: none;
            min-height: 1.2em;
        }
        .two-dialog-info-box .value:focus {
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }

        .two-dialog-info-box:last-child {
            margin-bottom: 0;
        }
        
        .cc-info-box1 {
            background: #9D90B4;
            color: #3F3551;
            font-family: 'Noto Serif KR', serif;
            font-weight: 900;
        }
        .cc-info-box1 .label { color: #5a4b73; }
        .cc-info-box1 .value { color: #3F3551; }

        .two-dialog-simple-card {
            width: 100%;
            height: auto;
            border-radius: 8px;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            overflow: hidden;
            position: relative;
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(2px);
        }

        .two-dialog-details {
            color: white;
            text-align: right;
            font-family: 'Gowun Batang', 'Roboto', sans-serif;
            z-index: 1;
            position: relative;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px);
            text-shadow: 1px 1px 3px #000;
        }
        .date { font-size: 0.9em; }
        .time { font-weight: bold; font-size: 1.2em;}

        .weather-control {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .weather-control label { color: white; font-family: 'Gowun Batang', sans-serif; }
        .weather-control button {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.5);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .weather-control button:hover { background-color: rgba(255,255,255,0.4); }
        .weather-control button.active {
            background-color: #9D90B4;
            color: #3F3551;
            font-weight: bold;
            border-color: #9D90B4;
        }
    </style>
</head>
<body>

    <div class="two-dialog-col">
        <div class="weather-control">
            <label>날씨 선택:</label>
            <button data-weather="Clear">맑음</button>
            <button data-weather="Cloudy">흐림</button>
            <button data-weather="Rainy">비</button>
            <button data-weather="Snowy">눈</button>
        </div>

        <div class="two-dialog-dialog">
            <div class="two-dialog-container">
                <!-- Shujen's Card -->
                <div id="Shujen-card" class="two-dialog-card">
                    <!-- 중요: 이 부분에 슈젠 캐릭터 이미지 주소를 넣어주세요. -->
                    <img src="https://blog.kakaocdn.net/dna/XY2cD/btsQcVPaulz/AAAAAAAAAAAAAAAAAAAAAJZ3Z_fDTtfBHM47pfw5lqP0bsVoVihwRJpQWsZidpBV/img.jpg?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1756652399&allow_ip=&allow_referer=&signature=UiYQcc52%2B9BKPXM3VGD8QFA6kmw%3D" alt="Shujen" class="two-dialog-char-img"/>
                    <div class="two-dialog-info">
                        <h3 style="text-align: center; margin-top: 0;">SHUJEN</h3>
                        <div class="two-dialog-info-box">
                            <span class="label">위치:</span>
                            <div class="value" id="Shujen-location" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box">
                            <span class="label">옷차림:</span>
                            <div class="value" id="Shujen-outfit" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box">
                            <span class="label">관계:</span>
                            <div class="value" id="Shujen-relations" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box">
                            <span class="label">상태:</span>
                            <div class="value" id="Shujen-status" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box cc-info-box1">
                            <span class="label">내심:</span>
                            <div class="value" id="Shujen-thoughts" contenteditable="true"></div>
                        </div>
                    </div>
                </div>
                <!-- Dalesun's Card -->
                <div id="Dalesun-card" class="two-dialog-card">
                     <!-- 중요: 이 부분에 데일선 캐릭터 이미지 주소를 넣어주세요. -->
                    <img src="https://blog.kakaocdn.net/dna/vEH4R/btsQez5muQl/AAAAAAAAAAAAAAAAAAAAACDTEePe-tAN-b53UmGHP8lC_1lwwyVcCxSWFTASxA-2/img.jpg?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1756652399&allow_ip=&allow_referer=&signature=uH5gz6Rk1gHYaIq0BmQ0j8In11o%3D" alt="Dalesun" class="two-dialog-char-img"/>
                    <div class="two-dialog-info">
                        <h3 style="text-align: center; margin-top: 0;">DALESUN</h3>
                        <div class="two-dialog-info-box">
                            <span class="label">위치:</span>
                            <div class="value" id="Dalesun-location" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box">
                            <span class="label">옷차림:</span>
                            <div class="value" id="Dalesun-outfit" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box">
                           <span class="label">관계:</span>
                            <div class="value" id="Dalesun-relations" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box">
                            <span class="label">상태:</span>
                            <div class="value" id="Dalesun-status" contenteditable="true"></div>
                        </div>
                        <div class="two-dialog-info-box cc-info-box1">
                            <span class="label">내심:</span>
                            <div class="value" id="Dalesun-thoughts" contenteditable="true"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="two-dialog-simple-card">
                <div class="two-dialog-details">
                    <div class="date" id="date-display"></div>
                    <div class="time" id="time-display"></div>
                </div>
            </div>
        </div>
    </div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
// Firebase 초기화: A커플과 동일한 firebaseConfig 코드를 사용합니다.
const firebaseConfig = {
    apiKey: "AIzaSyD-X7U6_dYnHTGWCikMw1zpb78SlWXMqqI",
    authDomain: "project-8519339398731273721.firebaseapp.com",
    databaseURL: "https://project-8519339398731273721-default-rtdb.firebaseio.com/",
    projectId: "project-8519339398731273721",
    storageBucket: "project-8519339398731273721.firebasestorage.app",
    messagingSenderId: "255930835214",
    appId: "1:255930835214:web:2482a3d96fd1928e3a775f"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

document.addEventListener('DOMContentLoaded', () => {
    const editableFields = document.querySelectorAll('.value[contenteditable="true"]');
    const weatherButtons = document.querySelectorAll('.weather-control button');
    const dateDisplay = document.getElementById('date-display');
    const timeDisplay = document.getElementById('time-display');

    const backgroundAssets = {
        Clear_morning: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FSEQyx%2FbtsQcmsxyMM%2FAAAAAAAAAAAAAAAAAAAAAL7FxjmcDQGEG5Rq38xgbAEycpXSofwQ22SIoNL0KDrI%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D9Icurk8mHUK%252FJ1MGefECm64u9X0%253D',
        Clear_afternoon: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fn51FS%2FbtsQdnqZxQk%2FAAAAAAAAAAAAAAAAAAAAAMlaHg-609qTTfenJnzCPx9a_KPCjhQwNUE3t78wsjEV%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DB9wxMhj9u%252BAen3o1mwVHBg4azpA%253D',
        Clear_evening: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FcUAlL3%2FbtsQdrNFI5Z%2FAAAAAAAAAAAAAAAAAAAAACEzBecgHYYy8PwwFc4iJ4TzWh9J-izW1IOWem3xgcJG%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DC2O0kIT%252BNPv89iwUP6PDjS0cB%252BU%253D',
        Clear_night: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2F0vELJ%2FbtsQfiI1hC2%2FAAAAAAAAAAAAAAAAAAAAAKyi16A-89cMhJ7rx9_XcXcFJGWeGiAfjaG2epqPnwdX%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3Dh1fl6uOhVrEqv3itvRbHo%252BvB8VE%253D',
        Cloudy_morning: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FPD6ma%2FbtsQc6wfSBL%2FAAAAAAAAAAAAAAAAAAAAAKLRfoP04NpOe0eFCm1Wc0HEOGSLw7lGXqKxWiLc2QqW%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DktgqTVZS3FYcvrdLCtqMw7dMgYo%253D',
        Cloudy_afternoon: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FBj5Zt%2FbtsQfgqSbh7%2FAAAAAAAAAAAAAAAAAAAAAOK994kPgRsvrM4IdJR9pQ36CfoLRofIX9mwk9KlUS-4%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D3ucQaO6Rea8fvD1YmMNmzpgWN2A%253D',
        Cloudy_evening: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FWJUS7%2FbtsQc6Xgl8h%2FAAAAAAAAAAAAAAAAAAAAABFXTm8PX1ZnGkUAwn7Yhcexr4ba0DbgyycYiZjXTJYI%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D6YSaafIrwcaO%252BOiR%252BjLy8J9x7B4%253D',
        Cloudy_night: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FbtOeiz%2FbtsQezjTim9%2FAAAAAAAAAAAAAAAAAAAAAPA7dLgQpkDM9FTfnoaOsnvTFUqpNxmBxyzxA2RvIP1E%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3Dkr17IOoWzVRALp02pOTejq8xkYM%253D',
        Rainy_day: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FeirrGO%2FbtsQe8l3mps%2FAAAAAAAAAAAAAAAAAAAAAAlRVPRGRhDEsjtVh-K3_HcJRanhbAq-TVytWEtp1WAi%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D52xs8gPufNM8CCjsmSvNfacieFg%253D',
        Snowy_day: 'https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FbUw51u%2FbtsQe80CgOq%2FAAAAAAAAAAAAAAAAAAAAABj0aN3yNisO633yhgtPR92YczqoBjCOdM1gdoHUhcZ_%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DhgDMAhLHulpswfMhJJAgq0C6lIo%253D',
    };

    let currentConfig = { weather: 'Clear' };

    // --- FIREBASE FUNCTIONS ---
    
    // ⭐ 중요: B커플의 데이터는 'statusData_B' 라는 별도의 경로에 저장됩니다.
    const dataRef = 'statusData_B'; 

    function syncDataFromFirebase() {
        database.ref(dataRef).on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                editableFields.forEach(field => {
                    if (data.characters && data.characters[field.id]) {
                        if (document.activeElement !== field) {
                           field.innerHTML = data.characters[field.id];
                        }
                    }
                });

                if (data.weather) {
                    currentConfig.weather = data.weather;
                    updateWeatherButtons();
                    updateTimeAndBackground();
                }
            }
        });
    }

    function saveDataToFirebase(id, value) {
        database.ref(`${dataRef}/characters/${id}`).set(value);
    }
    
    function saveWeatherToFirebase(weatherValue) {
        database.ref(`${dataRef}/weather`).set(weatherValue);
    }

    function updateWeatherButtons() {
        weatherButtons.forEach(button => {
            button.classList.toggle('active', button.dataset.weather === currentConfig.weather);
        });
    }

    function handleWeatherChange(event) {
        const newWeather = event.target.dataset.weather;
        saveWeatherToFirebase(newWeather);
    }

    let timeOffset = 0;
    async function syncTime() {
        try {
            const response = await fetch('https://timeapi.io/api/Time/current/zone?timeZone=Asia/Seoul');
            if (!response.ok) throw new Error('Network response was not ok.');
            const data = await response.json();
            const serverTime = new Date(data.dateTime).getTime();
            const localTime = new Date().getTime();
            timeOffset = serverTime - localTime;
        } catch (error) {
            console.error('온라인 시간 동기화 실패', error);
        }
    }

    function updateTimeAndBackground() {
        const correctedNow = new Date(new Date().getTime() + timeOffset);
        const optionsDate = { timeZone: 'Asia/Seoul', year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        const optionsTime = { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', hour12: true };
        dateDisplay.textContent = new Intl.DateTimeFormat('ko-KR', optionsDate).format(correctedNow);
        timeDisplay.textContent = new Intl.DateTimeFormat('en-US', optionsTime).format(correctedNow);

        const kstHour = new Date(correctedNow.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })).getHours();
        let timeOfDay;
        if (kstHour >= 6 && kstHour < 12) timeOfDay = 'morning';
        else if (kstHour >= 12 && kstHour < 18) timeOfDay = 'afternoon';
        else if (kstHour >= 18 && kstHour < 22) timeOfDay = 'evening';
        else timeOfDay = 'night';

        let bgKey = (currentConfig.weather === 'Rainy' || currentConfig.weather === 'Snowy')
            ? `${currentConfig.weather}_day`
            : `${currentConfig.weather}_${timeOfDay}`;
        
        const newBgAsset = backgroundAssets[bgKey] || backgroundAssets['Clear_morning'];
        const newBgUrl = `url('${newBgAsset}')`;
        if (document.body.style.backgroundImage !== newBgUrl) {
            document.body.style.backgroundImage = newBgUrl;
        }
    }
    
    editableFields.forEach(field => {
        field.addEventListener('input', (event) => {
            saveDataToFirebase(event.target.id, event.target.innerHTML);
        });
    });

    weatherButtons.forEach(button => {
        button.addEventListener('click', handleWeatherChange);
    });

    syncDataFromFirebase();
    
    syncTime().then(() => {
        updateTimeAndBackground(); 
        setInterval(updateTimeAndBackground, 1000); 
    });
    setInterval(syncTime, 600000);
});
</script>

</body>
</html>
